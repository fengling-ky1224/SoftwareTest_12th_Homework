import os
import matplotlib.pyplot as plt
import numpy as np

# 假设这是从日志中提取的损失值
train_loss = [
    0.6565936303907826, 0.5782627886341464, 0.5408492299818224, 0.5122293406917203,
    0.4856129509787406, 0.4608134473523786, 0.4403770075690362, 0.4215406938906639,
    0.4031561305446009, 0.3826047230151392, 0.36321411882677385, 0.3461842344653222,
    0.3337062174274075, 0.3246829605871631, 0.3158507539379981, 0.30492463323377794,
    0.29561635659587, 0.2887888541144709, 0.2823645419651462, 0.2768351281842878,
    0.2697727185103201, 0.26581292479268964, 0.2610123518013185, 0.25656762238471736,
    0.2528859737419313, 0.25001420609412656, 0.2465545780235721, 0.24335397683805035,
    0.24059497973611277, 0.23958281019041616, 0.2357607065669952, 0.23334439146903255,
    0.2312706175350374, 0.2302006684964703, 0.22700837206455968, 0.22680062103656032,
    0.22377828292308316, 0.22326590793748055, 0.22188082769993814, 0.22185679212693246,
    0.22027824819087982, 0.2192069657387272, 0.21693546012524637, 0.2167802308836291,
    0.21499507994421066, 0.21407190734340298, 0.21406447935488918, 0.2120675261943571,
    0.21126397002127864, 0.21123563426156197, 0.21017654192063115, 0.21062520578984292,
    0.20944863894293386, 0.20793433054800955, 0.2067276321111187, 0.20695278625334462,
    0.20603250207439547, 0.2043738168093466, 0.2037881636811841, 0.2032288053343373,
    0.2032522890836962, 0.20402379382041194, 0.20179947105146223, 0.20139359514559468,
    0.2029875454402739, 0.20169528213239485, 0.20138464098976505, 0.20059687091458228,
    0.2000393242605271, 0.1989413192195277, 0.19893150223839667, 0.1994081360678519,
    0.19980444062140681, 0.1983627720225242, 0.1978704938965459, 0.19747342794172226,
    0.19655944935737119, 0.19857112774925847, 0.19656070874583337, 0.197299906323033,
    0.19535421315700777, 0.19676227146579373, 0.19697915690560494, 0.19396860368790164,
    0.1955660403736176, 0.19570258307841518, 0.19389553223886796, 0.19526897274678753,
    0.19651989831078437, 0.1961338904596144, 0.19510217347452719, 0.1951525653562238,
    0.1956503006719774, 0.1940716697323707, 0.19483194764583342, 0.19421931957044908,
    0.19440476788628486, 0.19429426279760176, 0.1961207211978974, 0.1948399543762207
]

val_loss = [
    0.604374749319894, 0.5449023076466152, 0.5167782987867083, 0.49200692772865295,
    0.4821832392896925, 0.4294968843460083, 0.4063068415437426, 0.3908872732094356,
    0.3725426707948957, 0.3443036249705723, 0.3064163497516087, 0.2910154525722776,
    0.2751863811697279, 0.31952546324048725, 0.26944284779684885, 0.2868301442691258,
    0.25069284226213184, 0.24543771147727966, 0.24775311989443644, 0.23923061788082123,
    0.23544783890247345, 0.22733575531414577, 0.23576374990599497, 0.2254881731101445,
    0.2317684292793274, 0.2275004152740751, 0.22334782353469304, 0.21903575318200247,
    0.21768171446663992, 0.22205344694001333, 0.21909508109092712, 0.22292168651308333,
    0.2030951657465526, 0.21186642987387522, 0.21694837723459517, 0.19276861207825796,
    0.20115275255271367, 0.19979165920189448, 0.18822531827858516, 0.1964427445616041,
    0.19310828830514634, 0.1922753474542073, 0.1911106684378215, 0.19081372235502517,
    0.19501370191574097, 0.1940070561000279, 0.1936365387269429, 0.18763368470328196,
    0.19866814145020076, 0.19889364285128458, 0.1885813900402614, 0.19018518498965672,
    0.19629332848957606, 0.1954712016241891, 0.19823569697993143, 0.191760676247733,
    0.19620661650385177, 0.19030376310859407, 0.2060532761471612, 0.19079687233482087,
    0.18408362780298507, 0.19001979061535426, 0.18877809814044408, 0.19146351516246796,
    0.18993101588317327, 0.19317568625722611, 0.1931374200752803, 0.19275865703821182,
    0.19330718794039317, 0.1929684919970376, 0.19313938277108328
]

# 确保损失列表长度一致（根据实际数据调整）
min_len = min(len(train_loss), len(val_loss))
train_loss = train_loss[:min_len]
val_loss = val_loss[:min_len]

# 创建 plots 目录（如果不存在）
os.makedirs("plots", exist_ok=True)

# 绘制学习曲线
plt.figure(figsize=(10, 6))
plt.plot(train_loss, label="Training Loss", color="blue")
plt.plot(val_loss, label="Validation Loss", color="red")
plt.title("Unet-BUSI Training and Validation Loss")
plt.xlabel("Epoch")
plt.ylabel("Loss")
plt.legend()
plt.grid(True)

# 保存图像
plt.savefig("plots/busi_loss_plot.png")
plt.close()

print("学习曲线已保存到 plots/plot.png")